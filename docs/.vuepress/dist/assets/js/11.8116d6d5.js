(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{390:function(t,e,a){"use strict";a.r(e);var s=a(11),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"clamav-antivirus-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clamav-antivirus-server"}},[t._v("#")]),t._v(" ClamAV Antivirus Server")]),t._v(" "),a("TagLinks"),t._v(" "),a("p",[t._v("ClamAV is an open source (GPL) anti-virus engine used in a variety of situations including email scanning, web scanning, and end point security. It provides a number of utilities including a flexible and scalable multi-threaded daemon, a command line scanner and an advanced tool for automatic database updates.")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.clamav.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ClamAV website"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://www.clamav.net/downloads",target:"_blank",rel:"noopener noreferrer"}},[t._v("Source code"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Setup and configuration has been tested on following OS with version:")]),t._v(" "),a("ul",[a("li",[t._v("Ubuntu- 18.04, 20.04, Windows 10, Windows Server 2019")]),t._v(" "),a("li",[t._v("ClamAV- 0.102.4")])]),t._v(" "),a("h2",{attrs:{id:"configuration-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration-files"}},[t._v("#")]),t._v(" Configuration files")]),t._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("net-tools")]),t._v(" (optional)")])]),t._v(" "),a("h2",{attrs:{id:"installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[t._v("#")]),t._v(" Installation "),a("Badge",{attrs:{text:"Rev 1",type:"default"}})],1),t._v(" "),a("p",[t._v("In this tutorial we will install the ClamAV Antivirus Server (the clamav-daemon "),a("code",[t._v("192.168.0.1")]),t._v(") as a own server/virtual machine. We'll also use the multiscan option, so the more cores the faster your scans will perform. The clients ("),a("code",[t._v("192.168.0.2")]),t._v(", "),a("code",[t._v("192.168.0.3")]),t._v(") will not use the regular "),a("code",[t._v("clamavscan")]),t._v(" but rather the "),a("code",[t._v("clamdscan")]),t._v(" and listen to the ClamAV Antivirus Server's TCP socket instead of the local clients unix socket. This approach will also enable us to only keep the ClamAV defintion database up-to-date on the master server.")]),t._v(" "),a("h2",{attrs:{id:"clamav-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#clamav-server"}},[t._v("#")]),t._v(" ClamAV server")]),t._v(" "),a("p",[t._v("First download the ClamAV scanner and the ClamAV daemon.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo apt-get install clamav clamav-daemon\n")])])]),a("p",[t._v("Proceed to stop freshclam the automatic database update tool for ClamAV.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo systemctl stop clamav-freshclam\n")])])]),a("p",[t._v("Next run freshclam to update to the latest definition database.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo freshclam\n")])])]),a("p",[t._v("Once you've ran the freshclam command you can check the log "),a("code",[t._v("/var/log/clamav/freshclam.log")]),t._v(" for the current status and then start freshclam again.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ cat /var/log/clamav/freshclam.log\nSat Apr 10 17:51:37 2021 -> daily.cvd database is up to date (version: 26136, sigs: 3969743, f-level: 63, builder: raynman)\nSat Apr 10 17:51:37 2021 -> main.cvd database is up to date (version: 59, sigs: 4564902, f-level: 60, builder: sigmgr)\nSat Apr 10 17:51:37 2021 -> bytecode.cvd database is up to date (version: 333, sigs: 92, f-level: 63, builder: awillia2)\nserver@ubuntu:~$ sudo systemctl start clamav-freshclam\n")])])]),a("p",[t._v("Now we'll update our ClamAV daemon configuration to make our server listen to TCP socket 3310.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo nano /etc/clamav/clamd.conf\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Automatically Generated by clamav-daemon postinst")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#To reconfigure clamd run #dpkg-reconfigure clamav-daemon")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Please read /usr/share/doc/clamav-daemon/README.Debian.gz for details")]),t._v("\nLocalSocket /var/run/clamav/clamd.ctl\nFixStaleSocket "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nLocalSocketGroup clamav\nLocalSocketMode "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("666")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TemporaryDirectory is not set to its default /tmp here to make overriding")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the default with environment variables TMPDIR/TMP/TEMP possible")]),t._v("\nUser clamav\nTCPSocket "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3310")]),t._v("\n")])])]),a("p",[t._v("Restart ClamAV to apply the new changes.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo systemctl restart clamav-daemon.service\n")])])]),a("p",[t._v("To confirm that ClamAV listen to TCP port 3310 run the command below (requires "),a("code",[t._v("net-tools")]),t._v(").")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('server@ubuntu:~$ netstat -lnp | grep -E "(clam|3310)"\n(Not all processes could be identified, non-owned process info\n will not be shown, you would have to be root to see it all.)\ntcp        0      0 0.0.0.0:3310            0.0.0.0:*               LISTEN      -\ntcp6       0      0 :::3310                 :::*                    LISTEN      -\nunix  2      [ ACC ]     STREAM     LISTENING     73674    -                    /var/run/clamav/clamd.ctl\n')])])]),a("p",[t._v("Make sure that the firewall settings are in place and that the correct ports are opened for any ClamAV client. See the "),a("a",{attrs:{href:"#firewall-settings"}},[t._v("Firewall settings")]),t._v(" section for more information.")]),t._v(" "),a("h3",{attrs:{id:"keep-virus-definitions-up-to-date"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#keep-virus-definitions-up-to-date"}},[t._v("#")]),t._v(" Keep virus definitions up-to-date")]),t._v(" "),a("p",[t._v("To keep the ClamAV Antivirus Server definition database up-to-date you can configure freshclam when to check for new definitions. The default is set to 24 times per day. If you want to edit this you can define the times per day for freshclam to check for new updates.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo nano /etc/clamav/freshclam.conf\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Check for new database 24 times a day")]),t._v("\nChecks "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v("\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ clamdtop\n\n  _____/ /___ _____ ___  ____/ / /_____  ____\n / ___/ / __ `/ __ `__ \\/ __  / __/ __ \\/ __ \\\n/ /__/ / /_/ / / / / / / /_/ / /_/ /_/ / /_/ /\n\\___/_/\\__,_/_/ /_/ /_/\\__,_/\\__/\\____/ .___/\n                                     /_/\nConnecting to: /var/run/clamav/clamd.ctl\n")])])]),t._v(" "),a("h2",{attrs:{id:"ubuntu-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu-client"}},[t._v("#")]),t._v(" Ubuntu client")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("client@ubuntu:~$ sudo apt-get install clamav clamav-daemon\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("client@ubuntu:~$ sudo systemctl stop clamav-daemon.service\nclient@ubuntu:~$ sudo systemctl stop clamav-freshclam.service\nclient@ubuntu:~$ sudo systemctl disable clamav-daemon.service\nclient@ubuntu:~$ sudo systemctl disable clamav-freshclam.service\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("client@ubuntu:~$ sudo nano /etc/clamav/clamd.conf\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Automatically Generated by clamav-daemon postinst")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#To reconfigure clamd run #dpkg-reconfigure clamav-daemon")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Please read /usr/share/doc/clamav-daemon/README.Debian.gz for details")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#LocalSocket /var/run/clamav/clamd.ctl")]),t._v("\nFixStaleSocket "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\nLocalSocketGroup clamav\nLocalSocketMode "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("666")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TemporaryDirectory is not set to its default /tmp here to make overriding")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# the default with environment variables TMPDIR/TMP/TEMP possible")]),t._v("\nUser clamav\nTCPSocket "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3310")]),t._v("\nTCPAddr "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.1\n")])])]),a("h3",{attrs:{id:"running-scan"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-scan"}},[t._v("#")]),t._v(" Running scan")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("client@ubuntu:~$ sudo clamdscan --multiscan --quiet --file-list= --log=(add path)clamav_`date +'%Y-%m-%d'`.log\n")])])]),a("h2",{attrs:{id:"windows-client"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#windows-client"}},[t._v("#")]),t._v(" Windows client")]),t._v(" "),a("p",[t._v("First download the "),a("a",{attrs:{href:"http://www.clamav.net/downloads/production/ClamAV-0.102.4.exe",target:"_blank",rel:"noopener noreferrer"}},[t._v("ClamAV Windows Installer"),a("OutboundLink")],1),t._v(" (version 0.102.4). Right-click the executable file "),a("code",[t._v("ClamAV-0.102.4.exe")]),t._v(" and select "),a("code",[t._v("Run as Administrator")]),t._v(".")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client1.png",alt:"Windows 10 setup 1"}}),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client2.png",alt:"Windows 10 setup 2"}}),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client3.png",alt:"Windows 10 setup 3"}}),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client4.png",alt:"Windows 10 setup 4"}}),t._v(" "),a("p",[t._v("Run PowerShell as administrator and make sure you're in the correct path "),a("code",[t._v("C:\\WINDOWS\\system32")]),t._v(". Navigate to the ClamAV directory by entering "),a("code",[t._v("cd 'C:\\Program Files\\ClamAV\\")]),t._v(".")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client5.png",alt:"Windows 10 setup 5"}}),t._v(" "),a("p",[t._v("copy .\\conf_examples\\clamd.conf.sample .\\clamd.conf\nwrite.exe .\\clamd.conf")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client6.png",alt:"Windows 10 setup 6"}}),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Example config file for the Clam AV daemon")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("## Please read the clamd.conf(5) manual before editing this file.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("##")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Comment or remove the line below.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#Example")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# The daemon on Windows only supports unsecured TCP sockets.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Due to security reasons make sure that your IP & port is not")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# exposed to the open internet.")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TCP port address.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default: no")]),t._v("\nTCPSocket "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3310")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# TCP address.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# By default we bind to INADDR_ANY, probably not wise.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Enable the following to provide some degree of protection")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# from the outside world. This option can be specified multiple")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# times if you want to listen on multiple IPs. IPv6 is now supported.")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Default: no")]),t._v("\nTCPAddr "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.1\n")])])]),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/clamav/win10client7.png",alt:"Windows 10 setup 7"}}),t._v(" "),a("h3",{attrs:{id:"running-scan-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-scan-2"}},[t._v("#")]),t._v(" Running scan")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("client@windows:~PS$ .\\clamdscan.exe  --multiscan --quiet --file-list= --log=\n")])])]),a("h2",{attrs:{id:"firewall-settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#firewall-settings"}},[t._v("#")]),t._v(" Firewall settings")]),t._v(" "),a("p",[t._v("The firewall being used is UFW (Uncomplicated Firewall). It is set by default to deny incoming traffic, allow outgoing traffic and allow port 22 (OpenSSH). Read more about UFW "),a("a",{attrs:{href:"https://help.ubuntu.com/community/UFW",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("UFW Settings")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("server@ubuntu:~$ sudo ufw default deny incoming\nserver@ubuntu:~$ sudo ufw default allow outgoing\nserver@ubuntu:~$ sudo ufw allow 22\nserver@ubuntu:~$ sudo ufw enable\nCommand may disrupt existing ssh connections. Proceed with operation (y|n)? y\nFirewall is active and enabled on system startup\n")])])])]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('server@ubuntu:~$ sudo ufw allow proto tcp from 192.168.0.2 to any port 3310 comment "ClamAV client 1"\nserver@ubuntu:~$ sudo ufw allow proto tcp from 192.168.0.3 to any port 3310 comment "ClamAV client 2"\n')])])]),a("p",[t._v("If you want to allow TCP connection to port 3310 for the entire subnet apply the following UFW rule.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('server@ubuntu:~$ sudo ufw allow proto tcp from 192.168.0.0/24 to any port 3310 comment "ClamAV clients"\n')])])]),a("h2",{attrs:{id:"troubleshooting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[t._v("#")]),t._v(" Troubleshooting")]),t._v(" "),a("p",[t._v("In case you'll need help troubleshooting or support for ClamAV you can sign up for their mailing list at "),a("a",{attrs:{href:"https://lists.clamav.net/mailman/listinfo/clamav-users",target:"_blank",rel:"noopener noreferrer"}},[t._v("ClamAV users"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"enterprise-solutions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enterprise-solutions"}},[t._v("#")]),t._v(" Enterprise solutions "),a("Badge",{attrs:{text:"non-sponsored",type:"default"}})],1),t._v(" "),a("h3",{attrs:{id:"atomic-protector"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#atomic-protector"}},[t._v("#")]),t._v(" Atomic Protector "),a("Badge",{attrs:{text:"non-affiliate",type:"default"}})],1),t._v(" "),a("p",[t._v("Atomic Protector, is an upgrade from Atomic Secured Linux and Atomic Workload Protection products, provides maximum security and compliance for systems in on-premise, cloud and hybrid environments all in a single pane of glass you can run anywhere. Features include compliance and vulnerability management, reporting, intrusion prevention, file integrity monitoring, memory protection and exploit prevention, vulnerability shielding, web application and API protection, application control, and more.")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://atomicorp.com/atomic-protector/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Atomic Protector"),a("OutboundLink")],1)]),t._v(" "),a("social-share")],1)}),[],!1,null,null,null);e.default=n.exports}}]);