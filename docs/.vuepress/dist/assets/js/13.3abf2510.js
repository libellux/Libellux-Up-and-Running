(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{367:function(t,s,a){"use strict";a.r(s);var e=a(25),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"ossec-host-intrusion-detection-system"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ossec-host-intrusion-detection-system"}},[t._v("#")]),t._v(" OSSEC Host Intrusion Detection System")]),t._v(" "),a("TagLinks"),t._v(" "),a("p",[t._v("OSSEC is a full platform to monitor and control your systems. It mixes together all the aspects of HIDS (host-based intrusion detection), log monitoring and SIM/SIEM together in a simple, powerful and open source solution.")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.ossec.net/",target:"_blank",rel:"noopener noreferrer"}},[t._v("OSSEC website"),a("OutboundLink")],1),t._v(" "),a("a",{attrs:{href:"https://github.com/ossec/ossec-hids",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("Setup and configuration has been tested on following OS with version:")]),t._v(" "),a("ul",[a("li",[t._v("Ubuntu- 16.04, 18.04, 20.04")]),t._v(" "),a("li",[t._v("2.9.0 -> 3.6.0")])]),t._v(" "),a("h2",{attrs:{id:"configuration-files"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#configuration-files"}},[t._v("#")]),t._v(" Configuration files")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/libellux/Libellux-Up-and-Running/blob/master/docs/ossec/config/ossec.conf",target:"_blank",rel:"noopener noreferrer"}},[t._v("ossec.conf"),a("OutboundLink")],1),t._v(" (server)")]),t._v(" "),a("li",[t._v("ossec.conf (agent)")])]),t._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("build-essential")])]),t._v(" "),a("li",[a("code",[t._v("libssl-dev")])]),t._v(" "),a("li",[a("code",[t._v("libpcre2-dev")])]),t._v(" "),a("li",[a("code",[t._v("zlib1g-dev")])]),t._v(" "),a("li",[a("code",[t._v("jq")]),t._v(" (optional)")]),t._v(" "),a("li",[a("code",[t._v("inotify-tools")]),t._v(" (optional)")]),t._v(" "),a("li",[a("code",[t._v("pcre2")]),t._v(" library for version >= 3.3.0 ("),a("a",{attrs:{href:"https://ftp.pcre.org/pub/pcre/",target:"_blank",rel:"noopener noreferrer"}},[t._v("ftp.pcre.org"),a("OutboundLink")],1),t._v(")")])]),t._v(" "),a("h2",{attrs:{id:"server-installation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server-installation"}},[t._v("#")]),t._v(" Server Installation")]),t._v(" "),a("p",[t._v("Download the "),a("a",{attrs:{href:"https://github.com/ossec/ossec-hids/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("latest stable version"),a("OutboundLink")],1),t._v(" from ossec-hids GitHub. Extract the file and run the installation script. If receving build errors make sure that you installed all the required dependencies or check the "),a("a",{attrs:{href:"#troubleshooting"}},[t._v("troubleshooting section")]),t._v(" for details.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz\nlibellux@server:~$ tar -zxvf pcre2-10.32.tar.gz -C src/external/\nlibellux@server:~$ sudo apt-get install build-essential libssl-dev libpcre2-dev zlib1g-dev\nlibellux@server:~$ sudo PCRE2_SYSTEM=yes ./install.sh\n")])])]),a("p",[t._v("In this setup we will not use e-mail notifications as we will be using Slack as our notification channel. We wont be adding IPs to our whitelist now but in a later segment. Last we will also skip to enable the syslog port (514 udp).")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("[sudo] password for user: (en/br/cn/de/el/es/fr/hu/it/jp/nl/pl/ru/sr/tr) [en]: ENTER\nWhat kind of installation do you want (server, agent, local, hybrid or help)? server\nChoose where to install the OSSEC HIDS [/var/ossec/]: ENTER\nDo you want e-mail notification? (y/n) [y]: n\nDo you want to run the integrity check daemon? (y/n) [y]: y\nDo you want to run the rootkit detection engine? (y/n) [y]: y\nDo you want to enable active response? (y/n) [y]: y\nDo you want to enable the firewall-drop response? (y/n) [y]: y\nDo you want to add more IPs to the white list? (y/n)? [n]: n\nDo you want to enable remote syslog (port 514 udp)? (y/n) [y]: n\n--- Press ENTER to finish (maybe more information below). ---\n")])])]),a("h2",{attrs:{id:"server-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#server-configuration"}},[t._v("#")]),t._v(" Server Configuration")]),t._v(" "),a("h3",{attrs:{id:"allow-list"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#allow-list"}},[t._v("#")]),t._v(" Allow list")]),t._v(" "),a("p",[t._v("In the global section of the OSSEC configuration file add the IP addresses of the client(s) and services (e.g. OpenVAS) to allow.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("127.0.0.1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("::1"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("localhost.localdomain"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("127.0.0.53"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("192.168.0.2"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allow_list")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- OSSEC client --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h3",{attrs:{id:"repeated-offenders"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#repeated-offenders"}},[t._v("#")]),t._v(" Repeated offenders")]),t._v(" "),a("p",[t._v("The first time an IP is blocked it would use the default timeout of 600 seconds. If the IP would get blocked again it would follow the defined repeated offenders list. To enable repeated offenders add the entry in the active response config.")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),a("p",[t._v("Make sure that you add the repeated offenders entry at the top of the active response section in the ossec.conf file.")])]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Active Response Config --\x3e")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- Specify a comma seperated list of timeouts per\n    - re-incidence (in minutes).\n    --\x3e")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("repeated_offenders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("30,60,120,240,480"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("repeated_offenders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("Save the config and restart OSSEC to confirm that the repeated offenders been added.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo /var/ossec/bin/ossec-control restart\nStarting OSSEC HIDS v3.6.0...\n2020/08/06 14:38:31 ossec-execd: INFO: Adding offenders timeout: 30 (for #1)\n2020/08/06 14:38:31 ossec-execd: INFO: Adding offenders timeout: 60 (for #2)\n2020/08/06 14:38:31 ossec-execd: INFO: Adding offenders timeout: 120 (for #3)\n2020/08/06 14:38:31 ossec-execd: INFO: Adding offenders timeout: 240 (for #4)\n2020/08/06 14:38:31 ossec-execd: INFO: Adding offenders timeout: 480 (for #5)\nStarted ossec-execd...\nStarted ossec-analysisd...\nStarted ossec-logcollector...\nStarted ossec-remoted...\nStarted ossec-syscheckd...\nStarted ossec-monitord...\nCompleted.\n")])])]),a("h3",{attrs:{id:"psad-rules"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#psad-rules"}},[t._v("#")]),t._v(" PSAD rules")]),t._v(" "),a("p",[t._v("If using PSAD Intrusion Detection make sure to include the PSAD ruleset in the configuration file (as its not defined by default).")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("psad_rules.xml"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("local_rules.xml"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("include")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("rules")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("Before installing the OSSEC client(s) we need to make some adjustments to our OSSEC server. We will start by editing the configuration file (server) and whitelist the OSSEC clients IP address as well as secure applications communicating with our client(s).")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<global>\n    <white_list>[OSSEC-CLIENT-IP]</white_list>\n</global>\n")])])]),a("p",[t._v("Furthermore, to enable the function to harvest syslog we need to establish that our remote client connection is secure and allow it.")]),t._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("remote")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("connection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("secure"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("connection")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("allowed-ips")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("[OSSEC-CLIENT-IP]"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("allowed-ips")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("remote")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("Next we need to add the client to our OSSEC server and generate a client key. Run the command shown in the code segment below and follow the setup to fit our setup.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo /var/ossec/bin/manage_agents\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("****************************************\n* OSSEC HIDS v3.4.0 Agent Manager.     *\n* The following options are available: *\n****************************************\n    (A)dd an agent (A).  \n    (E)xtract key for an agent (E).\n    (L)ist already added agents (L).\n    (R)emove an agent (R).\n    (Q)quit.\nChoose your action: A,E,L,R or Q: a\n- Adding a new agent (use â€˜\\qâ€™ to return to the main menu).\n    Please provide the following:\n    * A name for the new agent: [CLIENT-SERVER-NAME]\n    * The IP Address of the new agent: [OSSEC-CLIENT-IP]\n    * An ID for the new agent[000]: 001\nAgent information:\n    ID:001\n    Name:[CLIENT-SERVER-NAME]\n    IP Address:[OSSEC-CLIENT-IP]\nConfirm adding it?(y/n): y\n")])])]),a("p",[t._v("Once we added the client proceed by extracting its agent key by providing the assigned agent ID.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("Choose your action: A,E,L,R or Q: e\nProvide the ID of the agent to extract the key (or '\\q' to quit): 001\nAgent key information for '001' is:\n-AGENT KEY-\n** Press Enter to return to the main menu.\n")])])]),a("p",[t._v("Next we need to go back to our OSSEC client and import our extracted agent key. Execute the command, shown in the code section below, on the agent machine and paste the key. Validate that our agent information is correct before adding it.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("foo@bar:~$ sudo /var/ossec/bin/manage_agents\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("****************************************\n* OSSEC HIDS v2.9.0 Agent Manager.     *\n* The following options are available: *\n****************************************\n    (I)mport key from the server (I).\n    (Q)uit.\nChoose your action: I or Q: i\nâ€¦\nPaste it here (or '\\q' to quit): -PASTE AGENT KEY-\nAgent information:\n    ID:001\n    Name:[CLIENT-SERVER-NAME]\n    IP Address:[OSSEC-CLIENT-IP]\nConfirm adding it?(y/n): y\n** Press ENTER to return to the main menu.\n** You must restart OSSEC for your changes to take effect.\n")])])]),a("p",[t._v("When we confirmed the agent, and have an assigned ID, go back once again to our OSSEC server and add the new agent ID within the active-response section, regarding Slack notifications, in the server's configuration file.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("ossec-slack"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("server,001"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("7"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("At client edit the OSSEC configuration file and ensure that the server IP is correct, and the repeated offenders section as well as the email directive is set.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("ossec_config")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("server-ip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("[OSSEC-HOST-IP]"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("server-ip")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("client")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("repeated_offenders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("30,60,120,240,480"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("repeated_offenders")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("email_notification")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("no"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("email_notification")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("global")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("Finally reload the OSSEC server and restart the client to enable and activate OSSEC HIDS.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo /var/ossec/bin/ossec-control reload\nfoo@bar:~$ sudo /var/ossec/bin/ossec-control restart\n")])])]),a("p",[t._v("Now after a short while m/monit should alert us that OSSEC processes are indeed running on our newly added client. To confirm that OSSEC and Slack alerts works, we can trigger rule 10100: First time user logged in, by simply login to our system through SSH. Once we are satisfied and rest assured everything works accurately and that syntax for configuration files and local rules (OSSEC server) are in order, proceed by enabling active response for the agent.")]),t._v(" "),a("p",[t._v("To enable the active response (intrusion prevention) plugin add the following sections found in the code segment beneath. Be assured that all services and applications running against our client is either whitelisted or configured in a way so we do not by mistake automatically ban necessary services. To apply our changes, once we are satisfied, reload OSSEC.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("firewall-drop"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("executable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("firewall-drop.sh"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("executable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("srcip"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("expect")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("timeout_allowed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("yes"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("timeout_allowed")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("disabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("no"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("disabled")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("firewall-drop"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("command")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("agent_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("[UID]"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("agent_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("local"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("rules_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("[optional]"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("rules_id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("6"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("level")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("600"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("timeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("active-response")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo /var/ossec/bin/ossec-control reload\n")])])]),a("h2",{attrs:{id:"firewall-settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#firewall-settings"}},[t._v("#")]),t._v(" Firewall settings")]),t._v(" "),a("p",[t._v("Firewall used is UFW (Uncomplicated Firewall) with a default set to deny incoming, allow outgoing traffic and allow port 22 (OpenSSH). Read more about UFW "),a("a",{attrs:{href:"https://help.ubuntu.com/community/UFW",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("UFW Settings")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo ufw default deny incoming\nlibellux@server:~$ sudo ufw default allow outgoing\nlibellux@server:~$ sudo ufw allow 22\nlibellux@server:~$ sudo ufw enable\nCommand may disrupt existing ssh connections. Proceed with operation (y|n)? y\nFirewall is active and enabled on system startup\n")])])])]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('libellux@server:~$ sudo ufw allow proto udp from [CLIENT] to any port 1514 comment "OSSEC"\nlibellux@client:~$ sudo ufw allow proto udp from [SERVER] to any port 1514 comment "OSSEC"\n')])])]),a("h2",{attrs:{id:"m-monit-monitoring"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#m-monit-monitoring"}},[t._v("#")]),t._v(" M/Monit monitoring")]),t._v(" "),a("p",[t._v("To monitor if the OSSEC daemons are running accordingly, we use Monit to monitor their status. Edit the Monit configuration file and add the lines below, continue with reloading the Monit daemon to apply our new monitor rules. If working correctly we shall now receive m/monit alerts saying processes is not running.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /usr/local/etc/monitrc\n")])])]),a("div",{staticClass:"language-config extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('# OSSEC processes\ncheck process ossec-agentd matching "ossec-agentd"\ncheck process ossec-execd matching "ossec-execd"\ncheck process ossec-logcollector matching "ossec-logcollector"\ncheck process ossec-syscheckd matching "ossec-syscheckd"\n')])])]),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ cd /usr/local/\nlibellux@server:~$ sudo ./bin/monit reload\n")])])]),a("h3",{attrs:{id:"monitor-m-monit-failed-login-attempts-with-ossec"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#monitor-m-monit-failed-login-attempts-with-ossec"}},[t._v("#")]),t._v(" Monitor M/Monit failed login attempts with OSSEC")]),t._v(" "),a("p",[t._v("Add the local file path in ossec.conf (client side).")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("foo@bar:~$ sudo nano /var/ossec/etc/ossec.conf\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("localfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("log_format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("syslog"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("log_format")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("/usr/local/mmonit-3.7.2/logs/error.log"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("location")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("localfile")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("Create a custom rule on the server and increase alert level to receive slack alerts.")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/rules/local_rules.xml\n")])])]),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("rule")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("id")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("102000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("level")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("7"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("if_sid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("2501"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("if_sid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("Unauthorized, authentication failed for"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("match")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("authentication_failed,"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("User authentication failure."),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("description")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("rule")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("h2",{attrs:{id:"slack-notifications"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#slack-notifications"}},[t._v("#")]),t._v(" Slack notifications")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),a("p",[t._v("Make sure that the log path is correct "),a("code",[t._v("/../")]),t._v(" in the ossec-slack.sh file.")])]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo nano /var/ossec/active-response/bin/ossec-slack.sh\n")])])]),a("div",{staticClass:"language-bash extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br")]),a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("CHANNEL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"#example"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SITE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"webhook url"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("SOURCE")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"ossec2slack"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Logging")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$LOCAL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PWD")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("pwd")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("date")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$0")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$6")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$7")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$8")]),t._v('"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("${"),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PWD")]),t._v("}")]),t._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v("/logs/active-responses.log\n")])])]),a("h2",{attrs:{id:"integrating-cloudflare"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integrating-cloudflare"}},[t._v("#")]),t._v(" Integrating Cloudflare")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("NOTE")]),t._v(" "),a("p",[t._v("The Cloudflare integration requires that you have the jq (processing JSON) tool installed. This tool is used when removing blocked IP's following the repeated offenders timeout interval.")])]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ sudo apt-get install jq\n")])])]),a("h3",{attrs:{id:"cloudflare-api-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cloudflare-api-token"}},[t._v("#")]),t._v(" Cloudflare API token")]),t._v(" "),a("p",[t._v("Login to Cloudflare, go to My Profile and API Tokens. Select Create Token and proceed to configure a Custom token. Give your token a descriptive name (e.g. OSSEC).")]),t._v(" "),a("img",{staticClass:"zoom-custom-imgs",attrs:{src:"/img/ossec/cloudflare_token.png",alt:"cloudflare token"}}),t._v(" "),a("h2",{attrs:{id:"upgrading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#upgrading"}},[t._v("#")]),t._v(" Upgrading")]),t._v(" "),a("p",[t._v("To upgrade to OSSEC 3.3.0 using the PCRE2 package simply download the package and install and upgrade OSSEC as normal:")]),t._v(" "),a("p",[t._v("libellux@server:~$ wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz\nlibellux@server:~$ tar -zxvf pcre2-10.32.tar.gz -C src/external/\nlibellux@server:~$ sudo ./install")]),t._v(" "),a("p",[t._v("To upgrade OSSEC simply download the "),a("a",{attrs:{href:"https://github.com/ossec/ossec-hids/releases",target:"_blank",rel:"noopener noreferrer"}},[t._v("latest release"),a("OutboundLink")],1),t._v(", extract the file and run the install script.")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("OSSEC HIDS v2.9.3 Installation Script - http://www.ossec.net\n\nYou are about to start the installation process of the OSSEC HIDS.\nYou must have a C compiler pre-installed in your system.\n\n    - System: Linux hostname 4.4.0-116-generic\n    - User: root\n    - Host: hostname\n\n-- Press ENTER to continue or Ctrl-C to abort. --\n\n- You already have OSSEC installed. Do you want to update it? (y/n): y\n")])])]),a("h2",{attrs:{id:"command-line"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#command-line"}},[t._v("#")]),t._v(" Command-line")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Command")]),t._v(" "),a("th",[t._v("Description")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("/var/ossec/bin/agent_control -lc")]),t._v(" "),a("td",[t._v("List all active agents")])]),t._v(" "),a("tr",[a("td",[t._v("/var/ossec/bin/ossec-logtest")]),t._v(" "),a("td",[t._v("Logtest")])]),t._v(" "),a("tr",[a("td",[t._v("/var/ossec/bin/ossec-control")]),t._v(" "),a("td",[t._v("start,stop,reload,restart,status,enable,disable")])]),t._v(" "),a("tr",[a("td",[t._v("/var/ossec/bin/manage_agents")]),t._v(" "),a("td",[t._v("manage agents (e.g., add, remove)")])])])]),t._v(" "),a("h2",{attrs:{id:"troubleshooting"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#troubleshooting"}},[t._v("#")]),t._v(" Troubleshooting")]),t._v(" "),a("p",[t._v("If you encounter any issue or having questions regarding OSSEC I recommend using their very helpful "),a("a",{attrs:{href:"https://groups.google.com/forum/#!forum/ossec-list",target:"_blank",rel:"noopener noreferrer"}},[t._v("mailing list"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"duplicate-counter-error"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#duplicate-counter-error"}},[t._v("#")]),t._v(" Duplicate counter error")]),t._v(" "),a("p",[t._v("In the OSSEC log /var/ossec/logs/ossec.log, you might notice that the log gets filled with warnings and errors as shown below.")]),t._v(" "),a("div",{staticClass:"language-log extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("2019/02/21 13:33:21 ossec-remoted: WARN: Duplicate error: [...]\n2019/02/21 13:33:21 ossec-remoted(1407): ERROR: Duplicated counter for [...]\n")])])]),a("p",[t._v("Stop both the OSSEC manager and the agent. In the agent server go to /var/ossec/queue/rids and remove all the files within the folder. At the manager server go into /var/ossec/queue/rids remove the file corresponding to the agents ID. Do not delete the sender_counter. Restart both.")]),t._v(" "),a("p",[t._v("Or disable the feature by editing "),a("code",[t._v("/var/ossec/etc/internal_options.conf")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("# Verify msg id (set to 0 to disable it)\nremoted.verify_msg_id=0\n")])])]),a("p",[t._v("Save and restart.")]),t._v(" "),a("h3",{attrs:{id:"build-essential"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#build-essential"}},[t._v("#")]),t._v(" build-essential")]),t._v(" "),a("p",[t._v("If receiving build error "),a("code",[t._v("./install.sh: 105: make: not found")]),t._v(" install the build-essential package "),a("code",[t._v("sudo apt-get install build-essential")]),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"libevent-dev"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#libevent-dev"}},[t._v("#")]),t._v(" libevent-dev")]),t._v(" "),a("p",[t._v("If receiving the build error below install the libevent development package "),a("code",[t._v("sudo apt-get install libevent-dev")]),t._v(".")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",[a("code",[t._v("os_maild/sendmail.c:12:10: fatal error: event.h: No such file or directory\n12 | #include <event.h>\n   |          ^~~~~~~~~\ncompilation terminated.\nmake: *** [Makefile:926: os_maild/sendmail.o] Error 1\n")])])]),a("h3",{attrs:{id:"pcre2-libpcre2-dev"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pcre2-libpcre2-dev"}},[t._v("#")]),t._v(" pcre2 & libpcre2-dev")]),t._v(" "),a("p",[t._v("If receiving the build error "),a("code",[t._v("./os_regex/os_regex.h:19:10: fatal error: pcre2.h: No such file or directory")]),t._v(" download and install pcre2 package (version 10.32) found "),a("a",{attrs:{href:"https://ftp.pcre.org/pub/pcre/",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("div",{staticClass:"language-console extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("libellux@server:~$ wget https://ftp.pcre.org/pub/pcre/pcre2-10.32.tar.gz\nlibellux@server:~$ tar -zxvf pcre2-10.32.tar.gz -C src/external/\n")])])]),a("p",[t._v("If the build error persist make sure to install the libpcre2 development package "),a("code",[t._v("sudo apt-get install libpcre2-dev")]),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"zlib1g-dev"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#zlib1g-dev"}},[t._v("#")]),t._v(" zlib1g-dev")]),t._v(" "),a("p",[t._v("If receving the build error "),a("code",[t._v("os_zlib/os_zlib.c:13:10: fatal error: zlib.h: No such file or directory")]),t._v(" install the zlib1g development package "),a("code",[t._v("sudo apt-get install zlib1g-dev")]),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"libssl-dev"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#libssl-dev"}},[t._v("#")]),t._v(" libssl-dev")]),t._v(" "),a("p",[t._v("If receiving the build error "),a("code",[t._v("./external/compat/includes.h:65:10: fatal error: openssl/opensslv.h: No such file or directory")]),t._v("install the libssl development package "),a("code",[t._v("sudo apt-get install libssl-dev")]),t._v(".")]),t._v(" "),a("h2",{attrs:{id:"recommended-reading"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#recommended-reading"}},[t._v("#")]),t._v(" Recommended reading "),a("Badge",{attrs:{text:"affiliate links",type:"warning"}})],1),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://amzn.to/33sOjdF",target:"_blank",rel:"noopener noreferrer"}},[t._v("Instant OSSEC Host-based Intrusion Detection, Lhotsky Brad, 2013"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://amzn.to/2XuL9lM",target:"_blank",rel:"noopener noreferrer"}},[t._v("OSSEC Host-Based Intrusion Detection Guide, Rory Bray, 2008"),a("OutboundLink")],1)])])],1)}),[],!1,null,null,null);s.default=n.exports}}]);