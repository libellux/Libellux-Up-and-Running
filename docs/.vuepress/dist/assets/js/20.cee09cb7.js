(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{398:function(t,e,s){"use strict";s.r(e);var a=s(12),n=Object(a.a)({},(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"psad-intrusion-detection-with-log-analysis"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#psad-intrusion-detection-with-log-analysis"}},[t._v("#")]),t._v(" PSAD Intrusion Detection with Log Analysis")]),t._v(" "),s("TagLinks"),t._v(" "),s("p",[t._v("PSAD (Port Scan Attack Detector) is a collection of three lightweight system daemons (two main daemons and one helper daemon) that run on Linux machines and analyze iptables log messages to detect port scans and other suspicious traffic. A typical deployment is to run PSAD on the iptables firewall where it has the fastest access to log data.")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://cipherdyne.org/psad/",target:"_blank",rel:"noopener noreferrer"}},[t._v("PSAD website"),s("OutboundLink")],1),t._v(" "),s("a",{attrs:{href:"https://github.com/mrash/psad",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub"),s("OutboundLink")],1)]),t._v(" "),s("p",[t._v("Setup and configuration has been tested on the following operating systems:")]),t._v(" "),s("ul",[s("li",[t._v("Ubuntu- 16.04, 18.04, 20.04")]),t._v(" "),s("li",[t._v("2.2.3 -> 2.4.6")])]),t._v(" "),s("h2",{attrs:{id:"configuration-files"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration-files"}},[t._v("#")]),t._v(" Configuration files")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://github.com/libellux/Libellux-Up-and-Running/blob/master/docs/psad/config/psad.conf",target:"_blank",rel:"noopener noreferrer"}},[t._v("psad.conf"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"prerequisites"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),s("p",[t._v("Dependancies when installing PSAD from source.")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("net-tools")])]),t._v(" "),s("li",[s("code",[t._v("g++")])])]),t._v(" "),s("h2",{attrs:{id:"install-psad-from-source"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#install-psad-from-source"}},[t._v("#")]),t._v(" Install PSAD from source")]),t._v(" "),s("p",[t._v("Make sure you have installed the dependency packages and once complete download the lastest stable version from the "),s("a",{attrs:{href:"https://github.com/mrash/psad",target:"_blank",rel:"noopener noreferrer"}},[t._v("PSAD GitHub"),s("OutboundLink")],1),t._v(", extract and run the installation script.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server@ubuntu:~$ sudo apt-get install net-tools & g++\nserver@ubuntu:~$ wget https://github.com/mrash/psad/archive/2.4.6.tar.gz\nserver@ubuntu:~$ tar -zxvf 2.4.6.tar.gz\nserver@ubuntu:~$ cd psad-2.4.6/\nserver@ubuntu:~$ sudo ./install.pl\n")])])]),s("div",{staticClass:"language-console extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v('[+] psad alerts will be sent to:\n\n       root@localhost\n\n[+] Would you like alerts sent to a different address ([y]/n)?  n\n\n[+] By default, psad parses all iptables log messages for scan activity.\n    However, psad can be configured to only parse those iptables messages\n    that match particular strings (that are specified in your iptables\n    ruleset with the --log-prefix option).\n\n    Would you like psad to only parse specific strings in iptables\n    messages (y/[n])?  n\n\n[+] By default, psad matches Snort rules against any IP addresses, but\n    psad offers the ability to restrict signature matches to specific\n    networks with the HOME_NET variable (similar to Snort).  However, psad\n    also offers the ability to acquire all local subnets on the local system\n    by parsing the output of "ifconfig", or the subnets can be restricted\n    to a limited set of networks.\n\n    First, is it ok to leave the HOME_NET setting as "any" ([y]/n)?  y\n\n[+] psad has the capability of sending scan data via email alerts to the\n    DShield distributed intrusion detection system (www.dshield.org).  By\n    default this feature is not enabled since firewall log data is sensitive,\n    but submitting logs to DShield provides a valuable service and assists\n    in generally enhancing internet security.  As an optional step, if you\n    have a DShield user id you can edit the "DSHIELD_USER_ID" variable\n    in /etc/psad/psad.conf\n\n    Would you like to enable DShield alerts (y/[n])?  n\n\n[+] Setting hostname to "client@ubuntu" in /etc/psad/psad.conf\n[+] The latest psad signatures can be installed with "psad --sig-update"\n    or installed now with install.pl.\n\n    If you decide to answer \'y\' to the next question, install.pl\n    will require DNS and network access now.\n\n    Would you like to install the latest signatures from\n      http://www.cipherdyne.org/psad/signatures (y/n)?  y\n\n[+] Enable psad at boot time ([y]/n)?  y\n\n[+] psad has been installed.\n')])])]),s("h2",{attrs:{id:"configuration"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#configuration"}},[t._v("#")]),t._v(" Configuration")]),t._v(" "),s("p",[t._v("The email address will be left as default (root@localhost;) as we use OSSEC to generate alerts.")]),t._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("br"),s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[t._v("$ "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("nano")]),t._v(" /etc/psad/psad.conf\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Machine hostname")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("HOSTNAME")]),t._v(" server@ubuntu"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Specify the home and external networks.  Note that by default the")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### ENABLE_INTF_LOCAL_NETS is enabled, so psad automatically detects")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### all of the directly connected subnets and uses this information as")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### the HOME_NET variable.")]),t._v("\nHOME_NET                    "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".0.0/24"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEXTERNAL_NET                any"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nIPT_SYSLOG_FILE             /var/log/syslog"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEXPECT_TCP_OPTIONS\t\t    Y"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nEMAIL_ALERT_DANGER_LEVEL\t"),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### Allow reporting methods to be enabled/restricted.  This keyword can")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('### accept values of "nosyslog" (don\'t write any messages to syslog),')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('### "noemail" (don\'t send any email messages), or "ALL" (to generate both')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('### syslog and email messages).  "ALL" is the default.  Both "nosyslog"')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('### and "noemail" can be combined with a comma to disable all logging')]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("### and alerting.")]),t._v("\nALERTING_METHODS            noemail"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),s("p",[t._v("To check the status of PSAD execute the following command.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server@ubuntu:~$ sudo psad -S\n")])])]),s("h2",{attrs:{id:"firewall-settings"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#firewall-settings"}},[t._v("#")]),t._v(" Firewall settings")]),t._v(" "),s("p",[t._v("The firewall being used is UFW (Uncomplicated Firewall). It is set by default to deny incoming traffic, allow outgoing traffic and allow port 22 (OpenSSH). Read more about UFW "),s("a",{attrs:{href:"https://help.ubuntu.com/community/UFW",target:"_blank",rel:"noopener noreferrer"}},[t._v("here"),s("OutboundLink")],1),t._v(".")]),t._v(" "),s("details",{staticClass:"custom-block details"},[s("summary",[t._v("UFW Settings")]),t._v(" "),s("div",{staticClass:"language-console extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server@ubuntu:~$ sudo ufw default deny incoming\nserver@ubuntu:~$ sudo ufw default allow outgoing\nserver@ubuntu:~$ sudo ufw allow 22\nserver@ubuntu:~$ sudo ufw enable\nCommand may disrupt existing ssh connections. Proceed with operation (y|n)? y\nFirewall is active and enabled on system startup\n")])])])]),t._v(" "),s("p",[t._v("First enable logging using the built-in UFW command below.")]),t._v(" "),s("div",{staticClass:"language-console extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server@ubuntu:~$ sudo ufw logging on\nLogging enabled\n")])])]),s("p",[t._v("Once enabled logging we also need to alter our UFW rules. Edit both configuration files (before.rules and before6.rules) and add the following before the COMMIT line.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server@ubuntu:~$ sudo nano /etc/ufw/before.rules\nserver@ubuntu:~$ sudo nano /etc/ufw/before6.rules\n")])])]),s("div",{staticClass:"language-bash extra-class"},[s("div",{staticClass:"highlight-lines"},[s("br"),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("div",{staticClass:"highlighted"},[t._v(" ")]),s("br"),s("br"),s("br"),s("br")]),s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# custom psad logging directives")]),t._v("\n-A INPUT -j LOG\n-A FORWARD -j LOG\n\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v('# do not delete the "COMMIT" line or these rules wont be processed')]),t._v("\nCOMMIT\n")])])]),s("p",[t._v("Next reload UFW and proceed to check psad with the built-in firewall analyze tool.")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("server@ubuntu:~$ sudo ufw reload\nserver@ubuntu:~$ sudo psad --fw-analyze\n[+] Parsing INPUT chain rules.\n[+] Parsing INPUT chain rules.\n[+] Firewall config looks good.\n[+] Completed check of firewall ruleset.\n[+] Results in /var/log/psad/fw_check\n[+] Exiting.\n")])])]),s("h2",{attrs:{id:"command-line"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#command-line"}},[t._v("#")]),t._v(" Command-line")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("Command")]),t._v(" "),s("th",[t._v("Description")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("psad -R")]),t._v(" "),s("td",[t._v("Restart psad")])]),t._v(" "),s("tr",[s("td",[t._v("psad -S")]),t._v(" "),s("td",[t._v("psad status")])]),t._v(" "),s("tr",[s("td",[t._v("psad --fw-analyze")]),t._v(" "),s("td",[t._v("Analyze the local iptables ruleset")])]),t._v(" "),s("tr",[s("td",[t._v("psad --sig-update")]),t._v(" "),s("td",[t._v("Download the latest set of psad signatures")])]),t._v(" "),s("tr",[s("td",[t._v("psad -H")]),t._v(" "),s("td",[t._v("Send all psad daemons a HUP signal to have them re-import configs")])])])]),t._v(" "),s("h2",{attrs:{id:"recommended-reading"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#recommended-reading"}},[t._v("#")]),t._v(" Recommended reading "),s("Badge",{attrs:{text:"affiliate links",type:"warning"}})],1),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://amzn.to/35OuPzP",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux Firewalls, Michael Rash, 2007"),s("OutboundLink")],1)])]),t._v(" "),s("p",[s("a",{attrs:{href:"https://ko-fi.com/B0B31BJU3",target:"_blank",rel:"noopener noreferrer"}},[s("img",{attrs:{src:"https://www.ko-fi.com/img/githubbutton_sm.svg",alt:"ko-fi"}}),s("OutboundLink")],1)]),t._v(" "),s("social-share")],1)}),[],!1,null,null,null);e.default=n.exports}}]);